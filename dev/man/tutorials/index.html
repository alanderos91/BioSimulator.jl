<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Tutorials · BioSimulator.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">BioSimulator.jl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../model-specification/">Model Specification</a></li><li><a class="tocitem" href="../simulation/">Simulation</a></li><li><a class="tocitem" href="../plotting/">Plotting</a></li><li class="is-active"><a class="tocitem" href>Tutorials</a><ul class="internal"><li><a class="tocitem" href="#Accessing-simulation-data-1"><span>Accessing simulation data</span></a></li><li><a class="tocitem" href="#Working-with-DataFrames-1"><span>Working with <code>DataFrames</code></span></a></li><li><a class="tocitem" href="#Saving-simulation-results-1"><span>Saving simulation results</span></a></li><li><a class="tocitem" href="#Obtaining-summary-statistics-1"><span>Obtaining summary statistics</span></a></li><li><a class="tocitem" href="#Customizing-output-1"><span>Customizing output</span></a></li></ul></li><li><a class="tocitem" href="../algorithms/">Algorithms and References</a></li><li><a class="tocitem" href="../citing/">Citing</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Tutorials</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Tutorials</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/alanderos91/BioSimulator.jl/blob/master/docs/src/man/tutorials.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h2 id="Accessing-simulation-data-1"><a class="docs-heading-anchor" href="#Accessing-simulation-data-1">Accessing simulation data</a><a class="docs-heading-anchor-permalink" href="#Accessing-simulation-data-1" title="Permalink"></a></h2><p>A single run generates a <code>SamplePath</code> object which is a recursive array provided by <a href="https://github.com/JuliaDiffEq/RecursiveArrayTools.jl">RecursiveArrayTools.jl</a>.</p><pre><code class="language-julia">sample_path = simulate(state, model, SortingDirect(), tfinal = 100.0, save_points = 0:25:100.0)

sample_path</code></pre><pre><code class="language-none">t: 5-element Array{Float64,1}:
   0.0
  25.0
  50.0
  75.0
 100.0
x: 5-element Array{Array{Int64,1},1}:
 [10, 0, 0, 0, 0]   
 [1, 9, 1, 16, 58]  
 [0, 10, 0, 17, 141]
 [0, 10, 0, 18, 143]
 [0, 10, 0, 17, 142]</code></pre><p>Access the state at the first time point:</p><pre><code class="language-julia">sample_path[1]</code></pre><pre><code class="language-none">5-element Array{Int64,1}:
 10
  0
  0
  0
  0</code></pre><p>Access the third component at the second time point:</p><pre><code class="language-julia">sample_path[3,2]</code></pre><pre><code class="language-none">1</code></pre><p>Access entire history for the third and fourth components:</p><pre><code class="language-julia">sample_path[[3,4], :]</code></pre><pre><code class="language-none">2×5 Array{Int64,2}:
 0   1   0   0   0
 0  16  17  18  17</code></pre><p>Running multiple simulations generates an <code>Ensemble</code>, a collection of <code>SamplePath</code> objects; that is, <code>Vector{SamplePath}</code>. These objects also support indexing:</p><pre><code class="language-julia"># ensemble of 10 trajectories
ensemble = [simulate(state, model, SortingDirect(), tfinal = 100.0, save_points = 0:25:100.0) for _ in 1:10];</code></pre><pre><code class="language-none">10-element Array{SamplePath{Int64,2,Array{Array{Int64,1},1},Array{Float64,1}},1}:
 t: [0.0, 25.0, 50.0, 75.0, 100.0]
x: Array{Int64,1}[[10, 0, 0, 0, 0], [3, 7, 0, 7, 53], [0, 10, 0, 10, 48], [0, 10, 0, 15, 104], [1, 9, 0, 12, 105]]  
 t: [0.0, 25.0, 50.0, 75.0, 100.0]
x: Array{Int64,1}[[10, 0, 0, 0, 0], [4, 6, 0, 5, 14], [5, 5, 0, 3, 15], [4, 6, 0, 5, 12], [6, 4, 0, 7, 11]]         
 t: [0.0, 25.0, 50.0, 75.0, 100.0]
x: Array{Int64,1}[[10, 0, 0, 0, 0], [3, 7, 0, 8, 31], [0, 10, 1, 15, 176], [1, 9, 0, 24, 184], [0, 10, 0, 15, 186]] 
 t: [0.0, 25.0, 50.0, 75.0, 100.0]
x: Array{Int64,1}[[10, 0, 0, 0, 0], [2, 8, 0, 6, 30], [2, 8, 0, 3, 31], [2, 8, 0, 10, 26], [3, 7, 0, 7, 28]]        
 t: [0.0, 25.0, 50.0, 75.0, 100.0]
x: Array{Int64,1}[[10, 0, 0, 0, 0], [3, 7, 1, 4, 22], [1, 9, 0, 15, 106], [0, 10, 0, 14, 129], [1, 9, 0, 17, 124]]  
 t: [0.0, 25.0, 50.0, 75.0, 100.0]
x: Array{Int64,1}[[10, 0, 0, 0, 0], [3, 7, 0, 11, 57], [1, 9, 0, 9, 55], [1, 9, 0, 10, 53], [2, 8, 0, 11, 53]]      
 t: [0.0, 25.0, 50.0, 75.0, 100.0]
x: Array{Int64,1}[[10, 0, 0, 0, 0], [1, 9, 0, 11, 57], [0, 10, 0, 14, 112], [1, 9, 0, 15, 112], [0, 10, 0, 12, 111]]
 t: [0.0, 25.0, 50.0, 75.0, 100.0]
x: Array{Int64,1}[[10, 0, 0, 0, 0], [10, 0, 1, 0, 0], [1, 9, 2, 18, 193], [2, 8, 0, 28, 255], [0, 10, 0, 23, 252]]  
 t: [0.0, 25.0, 50.0, 75.0, 100.0]
x: Array{Int64,1}[[10, 0, 0, 0, 0], [2, 8, 1, 6, 25], [1, 9, 0, 10, 39], [3, 7, 0, 10, 39], [1, 9, 0, 5, 39]]       
 t: [0.0, 25.0, 50.0, 75.0, 100.0]
x: Array{Int64,1}[[10, 0, 0, 0, 0], [3, 7, 0, 7, 15], [2, 8, 0, 4, 16], [6, 4, 0, 11, 33], [0, 10, 1, 14, 163]]     </code></pre><p>Retrieve an individual sample path:</p><pre><code class="language-julia">ensemble[2]</code></pre><pre><code class="language-none">t: 5-element Array{Float64,1}:
   0.0
  25.0
  50.0
  75.0
 100.0
x: 5-element Array{Array{Int64,1},1}:
 [10, 0, 0, 0, 0]
 [4, 6, 0, 5, 14]
 [5, 5, 0, 3, 15]
 [4, 6, 0, 5, 12]
 [6, 4, 0, 7, 11]</code></pre><p>Index into a SamplePath:</p><pre><code class="language-julia">ensemble[2][[3,4], :]</code></pre><pre><code class="language-none">2×5 Array{Int64,2}:
 0  0  0  0  0
 0  5  3  5  7</code></pre><h2 id="Working-with-DataFrames-1"><a class="docs-heading-anchor" href="#Working-with-DataFrames-1">Working with <code>DataFrames</code></a><a class="docs-heading-anchor-permalink" href="#Working-with-DataFrames-1" title="Permalink"></a></h2><p>Both <code>SamplePath</code> and <code>Ensemble</code> implement the <a href="https://github.com/queryverse/IterableTables.jl">IterableTables.jl</a> interface. This means that they act as <em>data sources</em> that can be converted into any supported <em>data sink</em>. For example, you can convert an <code>Ensemble</code> into a <code>DataFrame</code>:</p><pre><code class="language-julia">using DataFrames

DataFrame(ensemble)</code></pre><table class="data-frame"><thead><tr><th></th><th>trial</th><th>t</th><th>X1</th><th>X2</th><th>X3</th><th>X4</th><th>X5</th></tr><tr><th></th><th>Int64</th><th>Float64</th><th>Int64</th><th>Int64</th><th>Int64</th><th>Int64</th><th>Int64</th></tr></thead><tbody><p>50 rows × 7 columns</p><tr><th>1</th><td>1</td><td>0.0</td><td>10</td><td>0</td><td>0</td><td>0</td><td>0</td></tr><tr><th>2</th><td>1</td><td>25.0</td><td>3</td><td>7</td><td>0</td><td>7</td><td>53</td></tr><tr><th>3</th><td>1</td><td>50.0</td><td>0</td><td>10</td><td>0</td><td>10</td><td>48</td></tr><tr><th>4</th><td>1</td><td>75.0</td><td>0</td><td>10</td><td>0</td><td>15</td><td>104</td></tr><tr><th>5</th><td>1</td><td>100.0</td><td>1</td><td>9</td><td>0</td><td>12</td><td>105</td></tr><tr><th>6</th><td>2</td><td>0.0</td><td>10</td><td>0</td><td>0</td><td>0</td><td>0</td></tr><tr><th>7</th><td>2</td><td>25.0</td><td>4</td><td>6</td><td>0</td><td>5</td><td>14</td></tr><tr><th>8</th><td>2</td><td>50.0</td><td>5</td><td>5</td><td>0</td><td>3</td><td>15</td></tr><tr><th>9</th><td>2</td><td>75.0</td><td>4</td><td>6</td><td>0</td><td>5</td><td>12</td></tr><tr><th>10</th><td>2</td><td>100.0</td><td>6</td><td>4</td><td>0</td><td>7</td><td>11</td></tr><tr><th>11</th><td>3</td><td>0.0</td><td>10</td><td>0</td><td>0</td><td>0</td><td>0</td></tr><tr><th>12</th><td>3</td><td>25.0</td><td>3</td><td>7</td><td>0</td><td>8</td><td>31</td></tr><tr><th>13</th><td>3</td><td>50.0</td><td>0</td><td>10</td><td>1</td><td>15</td><td>176</td></tr><tr><th>14</th><td>3</td><td>75.0</td><td>1</td><td>9</td><td>0</td><td>24</td><td>184</td></tr><tr><th>15</th><td>3</td><td>100.0</td><td>0</td><td>10</td><td>0</td><td>15</td><td>186</td></tr><tr><th>16</th><td>4</td><td>0.0</td><td>10</td><td>0</td><td>0</td><td>0</td><td>0</td></tr><tr><th>17</th><td>4</td><td>25.0</td><td>2</td><td>8</td><td>0</td><td>6</td><td>30</td></tr><tr><th>18</th><td>4</td><td>50.0</td><td>2</td><td>8</td><td>0</td><td>3</td><td>31</td></tr><tr><th>19</th><td>4</td><td>75.0</td><td>2</td><td>8</td><td>0</td><td>10</td><td>26</td></tr><tr><th>20</th><td>4</td><td>100.0</td><td>3</td><td>7</td><td>0</td><td>7</td><td>28</td></tr><tr><th>21</th><td>5</td><td>0.0</td><td>10</td><td>0</td><td>0</td><td>0</td><td>0</td></tr><tr><th>22</th><td>5</td><td>25.0</td><td>3</td><td>7</td><td>1</td><td>4</td><td>22</td></tr><tr><th>23</th><td>5</td><td>50.0</td><td>1</td><td>9</td><td>0</td><td>15</td><td>106</td></tr><tr><th>24</th><td>5</td><td>75.0</td><td>0</td><td>10</td><td>0</td><td>14</td><td>129</td></tr><tr><th>25</th><td>5</td><td>100.0</td><td>1</td><td>9</td><td>0</td><td>17</td><td>124</td></tr><tr><th>26</th><td>6</td><td>0.0</td><td>10</td><td>0</td><td>0</td><td>0</td><td>0</td></tr><tr><th>27</th><td>6</td><td>25.0</td><td>3</td><td>7</td><td>0</td><td>11</td><td>57</td></tr><tr><th>28</th><td>6</td><td>50.0</td><td>1</td><td>9</td><td>0</td><td>9</td><td>55</td></tr><tr><th>29</th><td>6</td><td>75.0</td><td>1</td><td>9</td><td>0</td><td>10</td><td>53</td></tr><tr><th>30</th><td>6</td><td>100.0</td><td>2</td><td>8</td><td>0</td><td>11</td><td>53</td></tr><tr><th>31</th><td>7</td><td>0.0</td><td>10</td><td>0</td><td>0</td><td>0</td><td>0</td></tr><tr><th>32</th><td>7</td><td>25.0</td><td>1</td><td>9</td><td>0</td><td>11</td><td>57</td></tr><tr><th>33</th><td>7</td><td>50.0</td><td>0</td><td>10</td><td>0</td><td>14</td><td>112</td></tr><tr><th>34</th><td>7</td><td>75.0</td><td>1</td><td>9</td><td>0</td><td>15</td><td>112</td></tr><tr><th>35</th><td>7</td><td>100.0</td><td>0</td><td>10</td><td>0</td><td>12</td><td>111</td></tr><tr><th>36</th><td>8</td><td>0.0</td><td>10</td><td>0</td><td>0</td><td>0</td><td>0</td></tr><tr><th>37</th><td>8</td><td>25.0</td><td>10</td><td>0</td><td>1</td><td>0</td><td>0</td></tr><tr><th>38</th><td>8</td><td>50.0</td><td>1</td><td>9</td><td>2</td><td>18</td><td>193</td></tr><tr><th>39</th><td>8</td><td>75.0</td><td>2</td><td>8</td><td>0</td><td>28</td><td>255</td></tr><tr><th>40</th><td>8</td><td>100.0</td><td>0</td><td>10</td><td>0</td><td>23</td><td>252</td></tr><tr><th>41</th><td>9</td><td>0.0</td><td>10</td><td>0</td><td>0</td><td>0</td><td>0</td></tr><tr><th>42</th><td>9</td><td>25.0</td><td>2</td><td>8</td><td>1</td><td>6</td><td>25</td></tr><tr><th>43</th><td>9</td><td>50.0</td><td>1</td><td>9</td><td>0</td><td>10</td><td>39</td></tr><tr><th>44</th><td>9</td><td>75.0</td><td>3</td><td>7</td><td>0</td><td>10</td><td>39</td></tr><tr><th>45</th><td>9</td><td>100.0</td><td>1</td><td>9</td><td>0</td><td>5</td><td>39</td></tr><tr><th>46</th><td>10</td><td>0.0</td><td>10</td><td>0</td><td>0</td><td>0</td><td>0</td></tr><tr><th>47</th><td>10</td><td>25.0</td><td>3</td><td>7</td><td>0</td><td>7</td><td>15</td></tr><tr><th>48</th><td>10</td><td>50.0</td><td>2</td><td>8</td><td>0</td><td>4</td><td>16</td></tr><tr><th>49</th><td>10</td><td>75.0</td><td>6</td><td>4</td><td>0</td><td>11</td><td>33</td></tr><tr><th>50</th><td>10</td><td>100.0</td><td>0</td><td>10</td><td>1</td><td>14</td><td>163</td></tr></tbody></table><p>Each component of the state vector appears as a column, along with trajectory <code>trial</code> and timestamp <code>t</code> columns. If the conversion does not produce the expected result, one may be able to force the correct behavior using the <code>tablefy</code> function:</p><pre><code class="language-julia">import BioSimulator: tablefy

DataFrame(tablefy(sample_path)) # DataFrame(sample_path) is currently incorrect</code></pre><table class="data-frame"><thead><tr><th></th><th>t</th><th>X1</th><th>X2</th><th>X3</th><th>X4</th><th>X5</th></tr><tr><th></th><th>Float64</th><th>Int64</th><th>Int64</th><th>Int64</th><th>Int64</th><th>Int64</th></tr></thead><tbody><p>5 rows × 6 columns</p><tr><th>1</th><td>0.0</td><td>10</td><td>0</td><td>0</td><td>0</td><td>0</td></tr><tr><th>2</th><td>25.0</td><td>1</td><td>9</td><td>1</td><td>16</td><td>58</td></tr><tr><th>3</th><td>50.0</td><td>0</td><td>10</td><td>0</td><td>17</td><td>141</td></tr><tr><th>4</th><td>75.0</td><td>0</td><td>10</td><td>0</td><td>18</td><td>143</td></tr><tr><th>5</th><td>100.0</td><td>0</td><td>10</td><td>0</td><td>17</td><td>142</td></tr></tbody></table><h2 id="Saving-simulation-results-1"><a class="docs-heading-anchor" href="#Saving-simulation-results-1">Saving simulation results</a><a class="docs-heading-anchor-permalink" href="#Saving-simulation-results-1" title="Permalink"></a></h2><p>Because <code>SamplePath</code> and <code>Ensemble</code> support iteration, you can save simulation data directly using Julia&#39;s I/O interface. Alternatively, you can use existing packages such as CSV.jl:</p><pre><code class="language-none">using CSV

CSV.write(file, result, delim = &#39;\t&#39;)</code></pre><h2 id="Obtaining-summary-statistics-1"><a class="docs-heading-anchor" href="#Obtaining-summary-statistics-1">Obtaining summary statistics</a><a class="docs-heading-anchor-permalink" href="#Obtaining-summary-statistics-1" title="Permalink"></a></h2><p>Summary statistics for ensembles are supported directly:</p><pre><code class="language-none">using Statistics

mean(ensemble)
std(result)
var(result)</code></pre><h2 id="Customizing-output-1"><a class="docs-heading-anchor" href="#Customizing-output-1">Customizing output</a><a class="docs-heading-anchor-permalink" href="#Customizing-output-1" title="Permalink"></a></h2><p>It is possible to customize the data stored in a <code>SamplePath</code> with the keyword argument <code>save_function</code> in <a href="../simulation/#BioSimulator.simulate"><code>simulate</code></a>. This function must accept exactly three arguments:</p><pre><code class="language-none">function myfunction(simulator, state, model)
    # your code here
end</code></pre><p>It has access to data stored in a <code>simulator</code> object, the process&#39;s <code>state</code>, and the underlying <code>model</code>. This customized function should return the data to be stored in a <code>SamplePath</code>. Data can be any object, including custom Julia types. As an example, the function <code>save_state</code> is one of the default options that simply saves a copy of the system state at a given time. Note the use of annotations to dispatch on the type of <code>state</code></p><pre><code class="language-none"># this gets called for well-mixed simulations
save_state(simulator, state::Vector{T}, model) where T &lt;: Int = copy(state)

# this gets called for interacting particle systems
save_state(simulator, state::Lattice, model) = Configuration(state)</code></pre><p>Another option is <code>save_rates</code> which copies the rates for each possible jump</p><pre><code class="language-none">save_rates(simulator, state, model) = copy(jump_rates(simulator))</code></pre><p>BioSimulator provides the following high-level interface for accessing data:</p><article class="docstring"><header><a class="docstring-binding" id="BioSimulator.cumulative_intensity" href="#BioSimulator.cumulative_intensity"><code>BioSimulator.cumulative_intensity</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">cumulative_intensity(simulator::ExactSimulator)</code></pre><p>Retrieve the cumulative intensity of the process.</p></div></section></article><article class="docstring"><header><a class="docstring-binding" id="BioSimulator.jump_rates" href="#BioSimulator.jump_rates"><code>BioSimulator.jump_rates</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">jump_rates(simulator::ExactSimulator)</code></pre><p>Retrieve the current rates for each jump.</p><p>If the cache type is <code>HasRates()</code>, then <code>rate[j]</code> is the rate for reaction channel <code>j</code>. Otherwise if the cache type is <code>HasSums()</code>, then <code>rate[j]</code> is the cumulative <code>sum(rate[1:j])</code>.</p></div></section></article><article class="docstring"><header><a class="docstring-binding" id="BioSimulator.next_jump_index" href="#BioSimulator.next_jump_index"><code>BioSimulator.next_jump_index</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">next_jump_index(simulator::ExactSimulator)</code></pre><p>Retrieve the index of the next jump.</p></div></section></article><article class="docstring"><header><a class="docstring-binding" id="BioSimulator.next_jump_time" href="#BioSimulator.next_jump_time"><code>BioSimulator.next_jump_time</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">next_jump_time(simulator::ExactSimulator)</code></pre><p>Retrieve the time to the next jump.</p></div></section></article><div class="admonition is-success"><header class="admonition-header">Tip</header><div class="admonition-body"><ol><li><p>Avoid heavy computations inside a save function. It is usually better to store the data needed and do the work outside the simulation loop. Benchmark different implementations to see what approach works best for your application.</p></li><li><p>Some data, such as <code>jump_rates(simulator)</code> and <code>state</code> are stored as numerical arrays. These objects are <em>mutable</em> so you should generally return copies rather than the object itself.</p></li><li><p>The generated <code>SamplePath</code> object will support multi-dimensional indexing provided its data is stored as an array. For example, if we set <code>save_function = save_rates</code>, then <code>trajectory[k,j]</code> will return <code>rate[j]</code> at time <code>trajectory.t[k]</code>.</p></li></ol></div></div></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../plotting/">« Plotting</a><a class="docs-footer-nextpage" href="../algorithms/">Algorithms and References »</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Thursday 9 April 2020 07:45">Thursday 9 April 2020</span>. Using Julia version 1.2.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
